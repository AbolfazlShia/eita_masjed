// مناسبت های شمسی سال (ماه/روز)
import { toGregorian } from 'jalaali-js';
import { gregorianToShamsi } from './calendar';

export const defaultShamsiEvents: Record<string, string[]> = {
  '9/3': ['شهادت حضرت فاطمه زهرا سلام الله علیها (۱۱ هـ ق)'],
  '9/5': [
    'روز بسیج مستضعفان (تشکیل بسیج مستضعفان به فرمان حضرت امام خمینی (رحمة الله علیه) - ۱۳۵۸ ه ش)',
    'سالروز قیام مردم گرگان (۱۳۵۷ ه ش)',
  ],
  '9/7': ['روز نیروی دریایی'],
  '9/9': ['روز بزرگداشت شیخ مفید'],
  '9/10': [
    'شهادت آیت الله سید حسن مدرس (۱۳۱۶ ه ش) و روز مجلس',
    'روز جهانی مبارزه با ایدز',
  ],
  '9/11': ['شهادت میرزا کوچک خان جنگلی (۱۳۰۰ ه ش)'],
  '9/12': [
    'روز قانون اساسی جمهوری اسلامی ایران (تصویب قانون اساسی جمهوری اسلامی ایران - ۱۳۵۸ ه ش)',
    'روز جهانی معلولان',
  ],
  '9/13': [
    'روز بیمه',
    'سالروز وفات حضرت ام البنین سلام الله علیها',
    'روز تکریم مادران و همسران شهدا',
  ],
  '9/15': ['روز حسابدار'],
  '9/16': ['روز دانشجو', 'روز جهانی هواپیمایی'],
  '9/18': ['معرفی عراق به عنوان مسئول و آغازگر جنگ از سوی سازمان ملل (۱۳۷۰ ه ش)'],
  '9/19': ['تشکیل شورای عالی انقلاب فرهنگی به فرمان حضرت امام خمینی (رحمة الله علیه) (۱۳۶۳ ه ش)'],
  '9/20': [
    'شهادت آیت الله دستغیب سومین شهید محراب به دست منافقان (۱۳۶۰ ه ش)',
    'ولادت حضرت فاطمه زهرا سلام الله علیها (هشتم قبل از هجرت) و روز زن',
    'تولد حضرت امام خمینی (رحمة الله علیه) رهبر کبیر انقلاب اسلامی (۱۳۲۰ هـ ق)',
  ],
  '9/25': ['روز پژوهش'],
  '9/26': ['روز حمل و نقل و رانندگان'],
  '9/27': [
    'روز جهان عاری از خشونت و افراطی گری',
    'شهادت آیت الله دکتر محمد مفتح (۱۳۵۸ ه ش)',
    'روز وحدت حوزه و دانشگاه',
  ],
  '9/29': ['روز تجلیل از شهید تندگویان'],
  '9/30': ['شب یلدا'],

  '10/1': ['ولادت حضرت امام محمد باقر علیه السلام (۵۷ هـ ق)', 'شب لیلة الرغائب'],
  '10/3': ['روز ثبت احوال', 'شهادت حضرت امام علی النقی الهادی علیه السلام (۲۵۴ هـ ق)'],
  '10/4': ['میلاد حضرت عیسی مسیح علیه السلام'],
  '10/5': ['روز ملی ایمنی در برابر زلزله و کاهش اثرات بلایای طبیعی'],
  '10/7': [
    'شهادت آیت الله حسین غفاری به دست مأموران ستم‌شاهی پهلوی (۱۳۵۳ ه ش)',
    'سالروز تشکیل نهضت سوادآموزی به فرمان حضرت امام خمینی (رحمة الله علیه) (۱۳۵۸ ه ش)',
  ],
  '10/8': ['روز صنعت پتروشیمی'],
  '10/9': ['روز بصیرت و میثاق امت با ولایت'],
  '10/10': ['ولادت حضرت امام محمد تقی علیه السلام (جواد الائمه) (۱۹۵ هـ ق)'],
  '10/11': ['آغاز سال جدید میلادی'],
  '10/13': [
    'ابلاغ پیام تاریخی حضرت امام خمینی (رحمة الله علیه) به گورباچف رهبر شوروی سابق (۱۳۶۷ ه ش)',
    'روز جهانی مقاومت ـ شهادت الگوی اخلاص و عمل سردار سپهبد قاسم سلیمانی به دست استکبار جهانی (۱۳۹۸ ه ش)',
    'ولادت حضرت امام علی علیه السلام (۲۳ سال قبل از هجرت)',
    'آغاز ایام البیض (اعتکاف)',
  ],
  '10/15': [
    'ارتحال حضرت زینب سلام الله علیها (۶۲ هـ ق)',
    'تغییر قبله مسلمین از بیت المقدس به مکه معظمه (۲ هـ ق)',
  ],
  '10/17': ['اجرای طرح استعماری حذف حجاب به دست رضاخان (۱۳۱۴ ه ش)', 'روز بزرگداشت خواجوی کرمانی'],
  '10/18': ['وفات ابراهیم فرزند پیامبر اکرم صلی الله علیه و آله (۱۰ هـ ق)'],
  '10/19': ['قیام خونین مردم قم (۱۳۵۶ ه ش)'],
  '10/20': ['شهادت میرزا تقی خان امیرکبیر (۱۲۳۰ ه ش)'],
  '10/22': ['تشکیل شورای انقلاب به فرمان حضرت امام خمینی (رحمة الله علیه) (۱۳۵۷ ه ش)'],
  '10/24': ['فتح خیبر توسط حضرت امیرالمؤمنین علی علیه السلام (۷ هـ ق)'],
  '10/25': ['شهادت حضرت امام موسی کاظم علیه السلام (۱۸۳ هـ ق)'],
  '10/26': [
    'فرار شاه معدوم (۱۳۵۷ ه ش)',
    'وفات حضرت ابوطالب عموی پیامبر اکرم صلی الله علیه و آله و پدر امیرالمؤمنین علیه السلام (۳ سال قبل از هجرت)',
  ],
  '10/27': [
    'شهادت نواب صفوی، طهماسبی، برادران واحدی و ذوالقدر از فدائیان اسلام (۱۳۳۴ ه ش)',
    'مبعث حضرت رسول اکرم صلی الله علیه و آله (۱۳ سال قبل از هجرت)',
  ],
  '10/29': ['روز غزه'],

  '11/3': ['ولادت حضرت امام حسین علیه السلام (۴ هـ ق) و روز پاسدار'],
  '11/4': ['ولادت حضرت ابوالفضل العباس علیه السلام (۲۶ هـ ق) و روز جانباز'],
  '11/5': ['ولادت حضرت امام زین العابدین علیه السلام (۳۸ هـ ق)'],
  '11/6': ['سالروز حماسه مردم آمل', 'روز جهانی گمرک'],
  '11/11': ['ولادت حضرت علی اکبر علیه السلام (۳۳ هـ ق) و روز جوان'],
  '11/12': ['بازگشت حضرت امام خمینی (رحمة الله علیه) به ایران (۱۳۵۷ ه ش) و آغاز دهه مبارک فجر انقلاب اسلامی'],
  '11/14': ['روز فناوری فضایی'],
  '11/15': [
    'ولادت حضرت قائم عجل الله تعالی فرجه (۲۵۵ هـ ق)',
    'روز جهانی مستضعفین',
    'روز سربازان گمنام امام زمان عجل الله تعالی فرجه',
  ],
  '11/19': ['روز نیروی هوایی', 'غزوه بنی المصطلق (۶ هـ ق)'],
  '11/21': ['شکسته شدن حکومت نظامی به فرمان حضرت امام خمینی (رحمة الله علیه) (۱۳۵۷ ه ش)'],
  '11/22': ['پیروزی انقلاب اسلامی و سقوط نظام شاهنشاهی (۱۳۵۷ ه ش)'],
  '11/25': ['صدور حکم تاریخی حضرت امام خمینی (رحمة الله علیه) مبنی بر ارتداد سلمان رشدی نویسنده خائن کتاب آیات شیطانی (۱۳۶۷ ه ش)'],
  '11/29': ['قیام مردم تبریز به مناسبت چهلمین روز شهادت شهدای قم (۱۳۵۶ ه ش)', 'روز اقتصاد مقاومتی و کارآفرینی'],

  '12/3': ['کودتای انگلیسی رضاخان (۱۲۹۹ ه ش)'],
  '12/5': ['روز بزرگداشت خواجه نصیرالدین طوسی', 'روز مهندسی'],
  '12/8': ['روز امور تربیتی و تربیت اسلامی', 'روز بزرگداشت حکیم حاج ملاهادی سبزواری'],
  '12/9': ['روز حمایت از حقوق مصرف‌کنندگان', 'وفات حضرت خدیجه کبری سلام الله علیها (۳ سال قبل از هجرت)'],
  '12/14': [
    'روز احسان و نیکوکاری',
    'روز ترویج فرهنگ قرض‌الحسنه',
    'ولادت حضرت امام حسن مجتبی علیه السلام (۳ هـ ق) و روز اکرام',
    'روز اکرام و تکریم خیرین',
  ],
  '12/15': ['روز درختکاری'],
  '12/16': ['معراج رسول اکرم صلی الله علیه و آله (۶ ماه قبل از هجرت)', 'جنگ بدر (۲ هـ ق)'],
  '12/17': ['اولین شب قدر'],
  '12/18': [
    'روز بزرگداشت سید جمال الدین اسدآبادی',
    'سالروز تأسیس کانون‌های فرهنگی هنری مساجد کشور',
    'ضربت خوردن حضرت علی علیه السلام (۴۰ هـ ق)',
  ],
  '12/19': ['فتح مکه (۸ هـ ق)', 'دومین شب قدر'],
  '12/20': ['روز راهیان نور', 'شهادت حضرت امیرالمؤمنین علی علیه السلام (۴۰ هـ ق)'],
  '12/21': ['روز بزرگداشت نظامی گنجوی', 'سومین شب قدر'],
  '12/22': ['روز بزرگداشت شهدا (سالروز صدور فرمان حضرت امام خمینی (رحمة الله علیه) مبنی بر تأسیس بنیاد شهید انقلاب اسلامی - ۱۳۵۸ ه ش)'],
  '12/25': ['بمباران شیمیایی حلبچه توسط ارتش بعث عراق (۱۳۶۶ ه ش)', 'روز بزرگداشت پروین اعتصامی'],
  '12/26': ['روز جهانی قدس (آخرین جمعه ماه رمضان)'],
  '12/29': ['روز ملی شدن صنعت نفت ایران (۱۳۲۹ ه ش)'],
};

export const shamsiEvents = defaultShamsiEvents;

// مناسبت های میلادی شمسی (برای تماشای تقویم)
export const islamicMonthNames = [
  'محرم',
  'صفر',
  'ربیع‌الاول',
  'ربیع‌الثانی',
  'جمادی‌الاول',
  'جمادی‌الثانی',
  'رجب',
  'شعبان',
  'رمضان',
  'شوال',
  'ذی‌القعده',
  'ذی‌الحجه',
];

// اهم مناسبت های هلالی (قمری)
export const islamicEvents: Record<string, string[]> = {
  '1/9': ['تاسوعا'],
  '1/10': ['عاشورا - شهادت امام حسین (ع)'],
  '1/11': ['چهلم امام حسین (ع)'],
  '1/15': ['نیمه شعبان کمتر شدن', '۱۵ محرم'],
  
  '7/15': ['نیمه شعبان - تولد امام مهدی (عج)'],
  '7/27': ['شب قدر'],
  
  '8/1': ['اول رمضان'],
  '8/19': ['شب قدر'],
  '8/21': ['شب قدر'],
  '8/23': ['شب قدر'],
  '8/29': ['آخرین روز رمضان'],
  
  '9/1': ['عید فطر'],
  
  '10/10': ['عید قربان'],
  '11/10': ['عید غدیر - عید بزرگ'],
};

// دریافت مناسبت‌های امروز (شمسی)
export function getTodayShamsiEvents(): string[] {
  const { month, day } = gregorianToShamsi(new Date());
  const key = `${month}/${day}`;
  return shamsiEvents[key] || [];
}

// دریافت مناسبت‌های یک روز مشخص (شمسی)
export function getShamsiEventsByDate(
  year: number,
  month: number,
  day: number
): string[] {
  const key = `${month}/${day}`;
  return shamsiEvents[key] || [];
}

// دریافت مناسبت‌های یک ماه (شمسی)
export function getShamsiEventsByMonth(month: number): Record<number, string[]> {
  const events: Record<number, string[]> = {};
  
  for (const [dateKey, eventList] of Object.entries(shamsiEvents)) {
    const [m, d] = dateKey.split('/').map(Number);
    if (m === month) {
      events[d] = eventList;
    }
  }
  
  return events;
}

// فرمت‌کردن روز شمسی
export function formatShamsiDate(
  year: number,
  month: number,
  day: number,
  withDayName: boolean = false
): string {
  const shamsiMonths = [
    'فروردین',
    'اردیبهشت',
    'خرداد',
    'تیر',
    'مرداد',
    'شهریور',
    'مهر',
    'آبان',
    'آذر',
    'دی',
    'بهمن',
    'اسفند',
  ];

  // در JavaScript مقدار getDay به صورت 0=Sunday, 1=Monday, ..., 6=Saturday است
  // این آرایه را طوری می‌چینیم که ایندکس 0 = یکشنبه، 1 = دوشنبه، ...، 6 = شنبه باشد
  const dayNames = ['یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه', 'شنبه'];

  const monthName = shamsiMonths[month - 1];
  let result = `${day} ${monthName} ${year}`;

  if (withDayName) {
    // محاسبه روز هفته برای تاریخ شمسی با استفاده از jalaali-js
    const { gy, gm, gd } = toGregorian(year, month, day);
    const fullDate = new Date(gy, gm - 1, gd);
    const dayIndex = fullDate.getDay();
    result = `${dayNames[dayIndex]} ${day} ${monthName} ${year}`;
  }

  return result;
}

// تبدیل شمسی به میلادی


// حذف شده - از jalaali-js استفاده می‌کنیم
